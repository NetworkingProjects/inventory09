{% extends "base.html" %}

{% block title %}Edit {{ equipment.asset_tag }} - Lab Inventory{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Edit Equipment: {{ equipment.asset_tag }}</h2>
            <p class="mt-1 text-sm text-gray-600">Update the equipment details below.</p>
        </div>
        
        <form hx-post="{{ url_for('inventory.edit', id=equipment.id) }}" 
              hx-target="body"
              class="px-6 py-4 space-y-6">
            
            <!-- Basic Information -->
            <div>
                <h3 class="text-md font-medium text-gray-900 mb-4">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="asset_tag" class="block text-sm font-medium text-gray-700">
                            Asset Tag *
                        </label>
                        <input type="text" 
                               id="asset_tag" 
                               name="asset_tag" 
                               required
                               value="{{ equipment.asset_tag }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">
                            Name *
                        </label>
                        <input type="text" 
                               id="name" 
                               name="name" 
                               required
                               value="{{ equipment.name }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>

                <div class="mt-4">
                    <label for="description" class="block text-sm font-medium text-gray-700">
                        Description
                    </label>
                    <textarea id="description" 
                              name="description" 
                              rows="3"
                              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">{{ equipment.description or '' }}</textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                    <div>
                        <label for="category" class="block text-sm font-medium text-gray-700">
                            Category *
                        </label>
                        <input type="text" 
                               id="category" 
                               name="category" 
                               required
                               value="{{ equipment.category }}"
                               list="category-options"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <datalist id="category-options">
                            <option value="FPGA Board">
                            <option value="Oscilloscope">
                            <option value="Logic Analyzer">
                            <option value="Chip Sample">
                            <option value="Microcontroller">
                            <option value="Development Board">
                            <option value="Test Equipment">
                            <option value="Power Supply">
                        </datalist>
                    </div>

                    <div>
                        <label for="model_number" class="block text-sm font-medium text-gray-700">
                            Model Number
                        </label>
                        <input type="text" 
                               id="model_number" 
                               name="model_number" 
                               value="{{ equipment.model_number or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="manufacturer" class="block text-sm font-medium text-gray-700">
                            Manufacturer
                        </label>
                        <input type="text" 
                               id="manufacturer" 
                               name="manufacturer" 
                               value="{{ equipment.manufacturer or '' }}"
                               list="manufacturer-options"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <datalist id="manufacturer-options">
                            <option value="Xilinx">
                            <option value="Intel">
                            <option value="AMD">
                            <option value="Texas Instruments">
                            <option value="STMicroelectronics">
                            <option value="Microchip">
                            <option value="Analog Devices">
                            <option value="NXP">
                        </datalist>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div>
                        <label for="serial_number" class="block text-sm font-medium text-gray-700">
                            Serial Number
                        </label>
                        <input type="text" 
                               id="serial_number" 
                               name="serial_number" 
                               value="{{ equipment.serial_number or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="location" class="block text-sm font-medium text-gray-700">
                            Location
                        </label>
                        <input type="text" 
                               id="location" 
                               name="location" 
                               value="{{ equipment.location or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <!-- Status and Dates -->
            <div class="border-t pt-6">
                <h3 class="text-md font-medium text-gray-900 mb-4">Status and Dates</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700">
                            Status
                        </label>
                        <select id="status" 
                                name="status"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="Available" {{ 'selected' if equipment.status == 'Available' }}>Available</option>
                            <option value="In Use" {{ 'selected' if equipment.status == 'In Use' }}>In Use</option>
                            <option value="Under Maintenance" {{ 'selected' if equipment.status == 'Under Maintenance' }}>Under Maintenance</option>
                            <option value="Retired" {{ 'selected' if equipment.status == 'Retired' }}>Retired</option>
                            <option value="Missing" {{ 'selected' if equipment.status == 'Missing' }}>Missing</option>
                        </select>
                    </div>

                    <div>
                        <label for="condition" class="block text-sm font-medium text-gray-700">
                            Condition
                        </label>
                        <select id="condition" 
                                name="condition"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="New" {{ 'selected' if equipment.condition == 'New' }}>New</option>
                            <option value="Good" {{ 'selected' if equipment.condition == 'Good' }}>Good</option>
                            <option value="Needs Repair" {{ 'selected' if equipment.condition == 'Needs Repair' }}>Needs Repair</option>
                            <option value="Obsolete" {{ 'selected' if equipment.condition == 'Obsolete' }}>Obsolete</option>
                        </select>
                    </div>

                    <div>
                        <label for="procurement_date" class="block text-sm font-medium text-gray-700">
                            Procurement Date
                        </label>
                        <input type="date" 
                               id="procurement_date" 
                               name="procurement_date" 
                               value="{{ equipment.procurement_date.strftime('%Y-%m-%d') if equipment.procurement_date else '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="warranty_expiry" class="block text-sm font-medium text-gray-700">
                            Warranty Expiry
                        </label>
                        <input type="date" 
                               id="warranty_expiry" 
                               name="warranty_expiry" 
                               value="{{ equipment.warranty_expiry.strftime('%Y-%m-%d') if equipment.warranty_expiry else '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <!-- Chip-Specific Information -->
            <div class="border-t pt-6">
                <h3 class="text-md font-medium text-gray-900 mb-4">Chip-Specific Information (Optional)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="chip_type" class="block text-sm font-medium text-gray-700">
                            Chip Type
                        </label>
                        <input type="text" 
                               id="chip_type" 
                               name="chip_type" 
                               value="{{ equipment.chip_type or '' }}"
                               list="chip-type-options"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <datalist id="chip-type-options">
                            <option value="FPGA">
                            <option value="ASIC">
                            <option value="ARM">
                            <option value="Microcontroller">
                            <option value="DSP">
                            <option value="Memory">
                            <option value="Analog">
                        </datalist>
                    </div>

                    <div>
                        <label for="package_type" class="block text-sm font-medium text-gray-700">
                            Package Type
                        </label>
                        <input type="text" 
                               id="package_type" 
                               name="package_type" 
                               value="{{ equipment.package_type or '' }}"
                               list="package-options"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <datalist id="package-options">
                            <option value="BGA">
                            <option value="QFN">
                            <option value="DIP">
                            <option value="SOIC">
                            <option value="TQFP">
                            <option value="LQFP">
                            <option value="QFP">
                        </datalist>
                    </div>

                    <div>
                        <label for="pin_count" class="block text-sm font-medium text-gray-700">
                            Pin Count
                        </label>
                        <input type="number" 
                               id="pin_count" 
                               name="pin_count" 
                               min="1"
                               value="{{ equipment.pin_count or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                    <div>
                        <label for="temperature_grade" class="block text-sm font-medium text-gray-700">
                            Temperature Grade
                        </label>
                        <select id="temperature_grade" 
                                name="temperature_grade"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="">Select grade...</option>
                            <option value="Commercial" {{ 'selected' if equipment.temperature_grade == 'Commercial' }}>Commercial (0°C to 70°C)</option>
                            <option value="Industrial" {{ 'selected' if equipment.temperature_grade == 'Industrial' }}>Industrial (-40°C to 85°C)</option>
                            <option value="Military" {{ 'selected' if equipment.temperature_grade == 'Military' }}>Military (-55°C to 125°C)</option>
                        </select>
                    </div>

                    <div>
                        <label for="testing_status" class="block text-sm font-medium text-gray-700">
                            Testing Status
                        </label>
                        <select id="testing_status" 
                                name="testing_status"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="">Select status...</option>
                            <option value="Untested" {{ 'selected' if equipment.testing_status == 'Untested' }}>Untested</option>
                            <option value="Passed" {{ 'selected' if equipment.testing_status == 'Passed' }}>Passed</option>
                            <option value="Failed" {{ 'selected' if equipment.testing_status == 'Failed' }}>Failed</option>
                            <option value="Rework" {{ 'selected' if equipment.testing_status == 'Rework' }}>Rework</option>
                        </select>
                    </div>

                    <div>
                        <label for="revision_info" class="block text-sm font-medium text-gray-700">
                            Revision Info
                        </label>
                        <input type="text" 
                               id="revision_info" 
                               name="revision_info" 
                               value="{{ equipment.revision_info or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="border-t pt-6">
                <h3 class="text-md font-medium text-gray-900 mb-4">Additional Information</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="design_files" class="block text-sm font-medium text-gray-700">
                            Design Files URL
                        </label>
                        <input type="url" 
                               id="design_files" 
                               name="design_files" 
                               value="{{ equipment.design_files or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="assigned_to" class="block text-sm font-medium text-gray-700">
                            Assign To
                        </label>
                        <select id="assigned_to" 
                                name="assigned_to"
                                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                            <option value="">Unassigned</option>
                            {% for user in users %}
                            <option value="{{ user.id }}" {{ 'selected' if equipment.assigned_to_id == user.id }}>
                                {{ user.name }} ({{ user.email }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div>
                        <label for="purchase_cost" class="block text-sm font-medium text-gray-700">
                            Purchase Cost
                        </label>
                        <input type="number" 
                               id="purchase_cost" 
                               name="purchase_cost" 
                               step="0.01"
                               min="0"
                               value="{{ equipment.purchase_cost or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <div>
                        <label for="current_value" class="block text-sm font-medium text-gray-700">
                            Current Value
                        </label>
                        <input type="number" 
                               id="current_value" 
                               name="current_value" 
                               step="0.01"
                               min="0"
                               value="{{ equipment.current_value or '' }}"
                               class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                </div>

                <div class="mt-4">
                    <label for="tags" class="block text-sm font-medium text-gray-700">
                        Tags
                    </label>
                    <input type="text" 
                           id="tags" 
                           name="tags" 
                           value="{{ equipment.tags or '' }}"
                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                           placeholder="priority, critical, obsolete (comma-separated)">
                </div>

                <div class="mt-4">
                    <label for="notes" class="block text-sm font-medium text-gray-700">
                        Notes
                    </label>
                    <textarea id="notes" 
                              name="notes" 
                              rows="3"
                              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">{{ equipment.notes or '' }}</textarea>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="border-t pt-6 flex items-center justify-end space-x-3">
                <a href="{{ url_for('inventory.view', id=equipment.id) }}" 
                   class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Cancel
                </a>
                <button type="submit"
                        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <span class="htmx-indicator spinner mr-2" style="display: none;"></span>
                    Update Equipment
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}