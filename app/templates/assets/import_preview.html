
{% extends "base.html" %}
{% block title %}Import Preview{% endblock %}
{% block content %}
{% set s = stats if stats is defined else (s if s is defined else {'total_rows': total, 'empty_by_column': empty_counts, 'bad_date_rows': 0}) %}

<div class="max-w-5xl mx-auto px-4">
  <div class="bg-white rounded shadow p-6">
    <h1 class="text-xl font-semibold mb-4">Import Validation</h1>
    {% set s = stats %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-gray-50 rounded p-4"><div class="text-2xl font-bold">{{ s.total_rows }}</div><div class="text-sm text-gray-600">Total Rows</div></div>
      <div class="bg-gray-50 rounded p-4"><div class="text-2xl font-bold">{{ s.total_rows - s.invalid_rows }}</div><div class="text-sm text-gray-600">Valid Rows</div></div>
      <div class="bg-gray-50 rounded p-4"><div class="text-2xl font-bold">{{ s.invalid_rows }}</div><div class="text-sm text-gray-600">Rows With Issues</div></div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div><h3 class="font-medium mb-2">Missing Columns</h3>{% if s.missing_cols %}<ul class="list-disc pl-5 text-sm">{% for c in s.missing_cols %}<li>{{ c }}</li>{% endfor %}</ul>{% else %}<p class="text-sm text-green-700">None</p>{% endif %}</div>
      <div><h3 class="font-medium mb-2">Extra Columns</h3>{% if s.extra_cols %}<ul class="list-disc pl-5 text-sm">{% for c in s.extra_cols %}<li>{{ c }}</li>{% endfor %}</ul>{% else %}<p class="text-sm text-green-700">None</p>{% endif %}</div>
      <div><h3 class="font-medium mb-2">Email Format Issues</h3>{% if s.type_issues %}<ul class="list-disc pl-5 text-sm">{% for t in s.type_issues %}<li>{{ t.column }}: {{ t.count }}</li>{% endfor %}</ul>{% else %}<p class="text-sm text-green-700">None</p>{% endif %}</div>
      <div><h3 class="font-medium mb-2">Empty Cells per Column</h3><div class="grid grid-cols-2 gap-2 text-sm">{% for k,v in s.empties.items() %}<div class="flex justify-between border rounded px-2 py-1"><span>{{ k }}</span><span>{{ v }}</span></div>{% endfor %}</div></div>
    </div>
    {% if has_errors %}
      <div class="bg-yellow-50 border border-yellow-200 text-yellow-800 rounded p-4 mb-4">
        Issues found. You can <strong>Continue import anyway</strong> or <strong>Change file</strong>.
      </div>
      <form method="post" action="{{ url_for('assets.import_commit') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button class="bg-green-600 text-white px-4 py-2 rounded text-sm">Continue Import Anyway</button>
        <a href="{{ url_for('assets.import_page') }}" class="ml-2 text-sm text-gray-600 hover:text-gray-900">Change File</a>
      </form>
    {% else %}
      <div class="bg-green-50 border border-green-200 text-green-800 rounded p-4 mb-4">
        All good! No issues detected.
      </div>
      <form method="post" action="{{ url_for('assets.import_commit') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button class="bg-blue-600 text-white px-4 py-2 rounded text-sm">Import Now</button>
      </form>
    {% endif %}

  </div>
</div>
{% endblock %}
